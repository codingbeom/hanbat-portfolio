import{i as O}from"./@react-dnd-CcuaHj6U.js";var l;(function(o){o.mouse="mouse",o.touch="touch",o.keyboard="keyboard"})(l||(l={}));class M{get delay(){var e;return(e=this.args.delay)!==null&&e!==void 0?e:0}get scrollAngleRanges(){return this.args.scrollAngleRanges}get getDropTargetElementsAtPoint(){return this.args.getDropTargetElementsAtPoint}get ignoreContextMenu(){var e;return(e=this.args.ignoreContextMenu)!==null&&e!==void 0?e:!1}get enableHoverOutsideTarget(){var e;return(e=this.args.enableHoverOutsideTarget)!==null&&e!==void 0?e:!1}get enableKeyboardEvents(){var e;return(e=this.args.enableKeyboardEvents)!==null&&e!==void 0?e:!1}get enableMouseEvents(){var e;return(e=this.args.enableMouseEvents)!==null&&e!==void 0?e:!1}get enableTouchEvents(){var e;return(e=this.args.enableTouchEvents)!==null&&e!==void 0?e:!0}get touchSlop(){return this.args.touchSlop||0}get delayTouchStart(){var e,s,n,t;return(t=(n=(e=this.args)===null||e===void 0?void 0:e.delayTouchStart)!==null&&n!==void 0?n:(s=this.args)===null||s===void 0?void 0:s.delay)!==null&&t!==void 0?t:0}get delayMouseStart(){var e,s,n,t;return(t=(n=(e=this.args)===null||e===void 0?void 0:e.delayMouseStart)!==null&&n!==void 0?n:(s=this.args)===null||s===void 0?void 0:s.delay)!==null&&t!==void 0?t:0}get window(){if(this.context&&this.context.window)return this.context.window;if(typeof window<"u")return window}get document(){var e;if(!((e=this.context)===null||e===void 0)&&e.document)return this.context.document;if(this.window)return this.window.document}get rootElement(){var e;return((e=this.args)===null||e===void 0?void 0:e.rootElement)||this.document}constructor(e,s){this.args=e,this.context=s}}function N(o,e,s,n){return Math.sqrt(Math.pow(Math.abs(s-o),2)+Math.pow(Math.abs(n-e),2))}function w(o,e,s,n,t){if(!t)return!1;const i=Math.atan2(n-e,s-o)*180/Math.PI+180;for(let a=0;a<t.length;++a){const r=t[a];if(r&&(r.start==null||i>=r.start)&&(r.end==null||i<=r.end))return!0}return!1}const C={Left:1,Right:2,Center:4},x={Left:0,Center:1,Right:2};function T(o){return o.button===void 0||o.button===x.Left}function D(o){return o.buttons===void 0||(o.buttons&C.Left)===0}function b(o){return!!o.targetTouches}const L=1;function P(o){const e=o.nodeType===L?o:o.parentElement;if(!e)return;const{top:s,left:n}=e.getBoundingClientRect();return{x:n,y:s}}function _(o,e){if(o.targetTouches.length===1)return S(o.targetTouches[0]);if(e&&o.touches.length===1&&o.touches[0].target===e.target)return S(o.touches[0])}function S(o,e){return b(o)?_(o,e):{x:o.clientX,y:o.clientY}}const v={[l.mouse]:{start:"mousedown",move:"mousemove",end:"mouseup",contextmenu:"contextmenu"},[l.touch]:{start:"touchstart",move:"touchmove",end:"touchend"},[l.keyboard]:{keydown:"keydown"}};class g{profile(){var e;return{sourceNodes:this.sourceNodes.size,sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,targetNodes:this.targetNodes.size,dragOverTargetIds:((e=this.dragOverTargetIds)===null||e===void 0?void 0:e.length)||0}}get document(){return this.options.document}setup(){const e=this.options.rootElement;e&&(O(!g.isSetUp,"Cannot have two Touch backends at the same time."),g.isSetUp=!0,this.addEventListener(e,"start",this.getTopMoveStartHandler()),this.addEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.addEventListener(e,"move",this.handleTopMove),this.addEventListener(e,"move",this.handleTopMoveCapture,!0),this.addEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.addEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.addEventListener(e,"keydown",this.handleCancelOnEscape,!0))}teardown(){const e=this.options.rootElement;e&&(g.isSetUp=!1,this._mouseClientOffset={},this.removeEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.removeEventListener(e,"start",this.handleTopMoveStart),this.removeEventListener(e,"move",this.handleTopMoveCapture,!0),this.removeEventListener(e,"move",this.handleTopMove),this.removeEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.removeEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.removeEventListener(e,"keydown",this.handleCancelOnEscape,!0),this.uninstallSourceNodeRemovalObserver())}addEventListener(e,s,n,t=!1){const i=t;this.listenerTypes.forEach(function(a){const r=v[a][s];r&&e.addEventListener(r,n,i)})}removeEventListener(e,s,n,t=!1){const i=t;this.listenerTypes.forEach(function(a){const r=v[a][s];r&&e.removeEventListener(r,n,i)})}connectDragSource(e,s){const n=this.handleMoveStart.bind(this,e);return this.sourceNodes.set(e,s),this.addEventListener(s,"start",n),()=>{this.sourceNodes.delete(e),this.removeEventListener(s,"start",n)}}connectDragPreview(e,s,n){return this.sourcePreviewNodeOptions.set(e,n),this.sourcePreviewNodes.set(e,s),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDropTarget(e,s){const n=this.options.rootElement;if(!this.document||!n)return()=>{};const t=i=>{if(!this.document||!n||!this.monitor.isDragging())return;let a;switch(i.type){case v.mouse.move:a={x:i.clientX,y:i.clientY};break;case v.touch.move:var r,h;a={x:((r=i.touches[0])===null||r===void 0?void 0:r.clientX)||0,y:((h=i.touches[0])===null||h===void 0?void 0:h.clientY)||0};break}const c=a!=null?this.document.elementFromPoint(a.x,a.y):void 0,f=c&&s.contains(c);if(c===s||f)return this.handleMove(i,e)};return this.addEventListener(this.document.body,"move",t),this.targetNodes.set(e,s),()=>{this.document&&(this.targetNodes.delete(e),this.removeEventListener(this.document.body,"move",t))}}getTopMoveStartHandler(){return!this.options.delayTouchStart&&!this.options.delayMouseStart?this.handleTopMoveStart:this.handleTopMoveStartDelay}installSourceNodeRemovalObserver(e){this.uninstallSourceNodeRemovalObserver(),this.draggedSourceNode=e,this.draggedSourceNodeRemovalObserver=new MutationObserver(()=>{e&&!e.parentElement&&(this.resurrectSourceNode(),this.uninstallSourceNodeRemovalObserver())}),!(!e||!e.parentElement)&&this.draggedSourceNodeRemovalObserver.observe(e.parentElement,{childList:!0})}resurrectSourceNode(){this.document&&this.draggedSourceNode&&(this.draggedSourceNode.style.display="none",this.draggedSourceNode.removeAttribute("data-reactid"),this.document.body.appendChild(this.draggedSourceNode))}uninstallSourceNodeRemovalObserver(){this.draggedSourceNodeRemovalObserver&&this.draggedSourceNodeRemovalObserver.disconnect(),this.draggedSourceNodeRemovalObserver=void 0,this.draggedSourceNode=void 0}constructor(e,s,n){this.getSourceClientOffset=t=>{const i=this.sourceNodes.get(t);return i&&P(i)},this.handleTopMoveStartCapture=t=>{T(t)&&(this.moveStartSourceIds=[])},this.handleMoveStart=t=>{Array.isArray(this.moveStartSourceIds)&&this.moveStartSourceIds.unshift(t)},this.handleTopMoveStart=t=>{if(!T(t))return;const i=S(t);i&&(b(t)&&(this.lastTargetTouchFallback=t.targetTouches[0]),this._mouseClientOffset=i),this.waitingForDelay=!1},this.handleTopMoveStartDelay=t=>{if(!T(t))return;const i=t.type===v.touch.start?this.options.delayTouchStart:this.options.delayMouseStart;this.timeout=setTimeout(this.handleTopMoveStart.bind(this,t),i),this.waitingForDelay=!0},this.handleTopMoveCapture=()=>{this.dragOverTargetIds=[]},this.handleMove=(t,i)=>{this.dragOverTargetIds&&this.dragOverTargetIds.unshift(i)},this.handleTopMove=t=>{if(this.timeout&&clearTimeout(this.timeout),!this.document||this.waitingForDelay)return;const{moveStartSourceIds:i,dragOverTargetIds:a}=this,r=this.options.enableHoverOutsideTarget,h=S(t,this.lastTargetTouchFallback);if(!h)return;if(this._isScrolling||!this.monitor.isDragging()&&w(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,h.x,h.y,this.options.scrollAngleRanges)){this._isScrolling=!0;return}if(!this.monitor.isDragging()&&this._mouseClientOffset.hasOwnProperty("x")&&i&&N(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,h.x,h.y)>(this.options.touchSlop?this.options.touchSlop:0)&&(this.moveStartSourceIds=void 0,this.actions.beginDrag(i,{clientOffset:this._mouseClientOffset,getSourceClientOffset:this.getSourceClientOffset,publishSource:!1})),!this.monitor.isDragging())return;const c=this.sourceNodes.get(this.monitor.getSourceId());this.installSourceNodeRemovalObserver(c),this.actions.publishDragSource(),t.cancelable&&t.preventDefault();const f=(a||[]).map(u=>this.targetNodes.get(u)).filter(u=>!!u),E=this.options.getDropTargetElementsAtPoint?this.options.getDropTargetElementsAtPoint(h.x,h.y,f):this.document.elementsFromPoint(h.x,h.y),p=[];for(const u in E){if(!E.hasOwnProperty(u))continue;let d=E[u];for(d!=null&&p.push(d);d;)d=d.parentElement,d&&p.indexOf(d)===-1&&p.push(d)}const m=p.filter(u=>f.indexOf(u)>-1).map(u=>this._getDropTargetId(u)).filter(u=>!!u).filter((u,d,y)=>y.indexOf(u)===d);if(r)for(const u in this.targetNodes){const d=this.targetNodes.get(u);if(c&&d&&d.contains(c)&&m.indexOf(u)===-1){m.unshift(u);break}}m.reverse(),this.actions.hover(m,{clientOffset:h})},this._getDropTargetId=t=>{const i=this.targetNodes.keys();let a=i.next();for(;a.done===!1;){const r=a.value;if(t===this.targetNodes.get(r))return r;a=i.next()}},this.handleTopMoveEndCapture=t=>{if(this._isScrolling=!1,this.lastTargetTouchFallback=void 0,!!D(t)){if(!this.monitor.isDragging()||this.monitor.didDrop()){this.moveStartSourceIds=void 0;return}t.cancelable&&t.preventDefault(),this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.drop(),this.actions.endDrag()}},this.handleCancelOnEscape=t=>{t.key==="Escape"&&this.monitor.isDragging()&&(this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.endDrag())},this.options=new M(n,s),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.sourceNodes=new Map,this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.targetNodes=new Map,this.listenerTypes=[],this._mouseClientOffset={},this._isScrolling=!1,this.options.enableMouseEvents&&this.listenerTypes.push(l.mouse),this.options.enableTouchEvents&&this.listenerTypes.push(l.touch),this.options.enableKeyboardEvents&&this.listenerTypes.push(l.keyboard)}}const k=function(e,s={},n={}){return new g(e,s,n)};export{k as T};
